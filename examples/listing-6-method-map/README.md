# Method Map

## Example Structure

There example contains two projects:
 
  * `plugin` stands for the example of framework
  * `client` application that uses (in our cse just tests) the framework
 
The project `plugen` is not aware about the project `client`. Thus, you can
apply `plugin` to any other application.

### Plugin Project 

Here is an example of a method map generated by 
[Uniform Factory](https://github.com/antkudruk/uniformfactory).

Suppose we have objects that may be put into a specific coordinate.   

The wrapper should provide a method to return a map of coordinates using the 
same approach as we used for MethodList.

```
public interface Coordinate {
    long getCoordinate(Long scale);
}

public interface PointWrapper {
    Map<String, Coordinate> getCoords();
}
```

Unlikely for MethodList, MethodMap requires a rule to get the key in the map
based on the annotation. So we'll define a property (in this case default 
value) to define the key.

```
@Retention(RetentionPolicy.RUNTIME)
@Target({ElementType.METHOD, ElementType.FIELD})
public @interface CoordinateMarker {
    String value();
}
```

And we'll describe the way of implementing that map.

```
public class ClassFactoryGeneratorImpl extends DefaultMetaClassFactory<PointWrapper> {
    public ClassFactoryGeneratorImpl() throws NoSuchMethodException {
        super(new ClassFactory.ShortcutBuilder<>(PointWrapper.class)

                .addMethodMap(PointWrapper.class.getMethod("getCoords"), long.class)
                .setMarkerAnnotation(CoordinateMarker.class, CoordinateMarker::value)
                .setFunctionalInterface(Coordinate.class)
                .parameterSource(Long.class, 0)

                .applyTo(new AnyParameterFilter())
                .addTranslator(boolean.class, t -> t > 0)
                .addTranslator(String.class, Object::toString)
                .addTranslator(long.class, t -> t)

                .finishParameterDescription()
                .addResultTranslator(Boolean.class, t -> t ? 1L : -1L)
                .addResultTranslator(String.class, Long::parseLong)
                .addResultTranslator(int.class, Integer::longValue)

                .endMethodDescription()

                .build());
    }
}
```

As a result you'll be able to get each axis position via that map

```
        PointTypeA pointTypeA = new PointTypeA();
        Point point = (Point) pointTypeA;

        point.getWrapper().getCoords().get("x").getCoordinate(10L);
        point.getWrapper().getCoords().get("y").getCoordinate(15L);
        point.getWrapper().getCoords().get("z").getCoordinate(20L);
```

You can use the following code to get `wrappers` generated behind the scenes.
To get it work just implement the following plugin.

```
public class MethodTreeWrapperClassFactory {

    private static final ClassFactory<Wrapper> classFactory;

    static  {
        try {
            classFactory = new ClassFactory.ShortcutBuilder<>(Wrapper.class)

                    .addMethodMap(Wrapper.class.getMethod("getWrappers"), String.class)
                    .setMarkerAnnotation(FunctionalElement.class, FunctionalElement::value)
                    .setFunctionalInterface(Fun.class)

                    .parameterSource(String.class, 0)
                    .applyToAnnotated(First.class)
                    .finishParameterDescription()

                    .parameterSource(String.class, 1)
                    .applyToAnnotated(Second.class)
                    .addTranslator(Boolean.class, "true"::equalsIgnoreCase)
                    .addTranslator(Long.class, Long::parseLong)
                    .finishParameterDescription()

                    .addResultTranslator(Long.class, t -> t.toString() + " units")
                    .addResultTranslator(Boolean.class, t -> t ? "Yes" : "No")
                    .endMethodDescription()

                    .build();
        } catch (ReflectiveOperationException ex) {
            throw new RuntimeException(ex);
        }
    }

    public class PluginImpl extends WrapperPlugin<Wrapper> {
        public PluginImpl( ) {
            super(
                    Origin.class,
                    Wrapper.class,
                    Marker.class,
                    "examplePlugin",
                    ClassFactoryGeneratorImpl.class);
        }
    }

    public static class CtorMeta extends DefaultMetaClassFactory<Wrapper> {
        public CtorMeta() {
            super(classFactory);
        }
    }
}
```
